(function(window, document, undefined) {
    
    /* 加载最受关注图书 | (非)虚构类 */
    let book_list_data = {
        'book_fiction': {
            title: '最受关注图书 | 虚构类',
            subject_collection_items: [{"original_price":null,"rating":{"count":2250,"max":10,"value":7.9},"actions":["可阅读"],"date":null,"year":["2018-3"],"card_subtitle":"[日] 村上春树 / 2018 / 上海译文出版社","recommend_comment":"操，见林少华就直接弃的，他妈的有没有脑子 —— 苏不愀的短评","id":"27199470","title":"刺杀骑士团长","label":null,"type":"book","description":"","price":null,"press":["上海译文出版社"],"info":"[日] 村上春树/上海译文出版社/2018-3","url":"https://www.douban.com/doubanapp/dispatch?uri=/book/27199470/","release_date":null,"author":["[日] 村上春树"],"cover":{"url":"https://qnmob3.doubanio.com/lpic/s29687411.jpg?imageView2/0/q/80/w/9999/h/400/format/jpg","width":0,"shape":"rectangle","height":0},"uri":"douban://douban.com/book/27199470","subtype":"","reviewer_name":"","null_rating_reason":""},{"original_price":null,"rating":{"count":1431,"max":10,"value":8.7},"actions":["可阅读"],"date":null,"year":["2018-1"],"card_subtitle":"[美] R.J.帕拉西奥 / 2018 / 人民文学出版社","recommend_comment":"看封面就想读了呀！听说电影要在国内上映了！ —— 微笑的影子的短评","id":"27603501","title":"奇迹男孩","label":null,"type":"book","description":"","price":null,"press":["人民文学出版社"],"info":"[美] R.J.帕拉西奥/人民文学出版社/2018-1","url":"https://www.douban.com/doubanapp/dispatch?uri=/book/27603501/","release_date":null,"author":["[美] R.J.帕拉西奥"],"cover":{"url":"https://qnmob3.doubanio.com/lpic/s29642731.jpg?imageView2/0/q/80/w/9999/h/400/format/jpg","width":0,"shape":"rectangle","height":0},"uri":"douban://douban.com/book/27603501","subtype":"","reviewer_name":"","null_rating_reason":""},{"original_price":null,"rating":{"count":1163,"max":10,"value":7.7},"actions":[],"date":null,"year":["2018-1"],"card_subtitle":"[日] 东野圭吾 / 2018 / 北京十月文艺出版社","recommend_comment":"这个故事，发生在相对封闭的小空间里，有舞台剧那种感觉，人物冲突满是短兵相接的味道，这与作者之前的作品还是有区别，可看作一种新的体验~ 从以前的 恶意，到这部讲 杀意 的假面山庄，东野圭吾的小说还是叫人停不下来啊~~大戏已经落幕了，但生活没有，那张假面具，总还是会戴在你我他的脸上，暗藏玄机。 —— 惊蛰小白的短评","id":"27200261","title":"假面山庄","label":null,"type":"book","description":"","price":null,"press":["北京十月文艺出版社"],"info":"[日] 东野圭吾/北京十月文艺出版社/2018-1","url":"https://www.douban.com/doubanapp/dispatch?uri=/book/27200261/","release_date":null,"author":["[日] 东野圭吾"],"cover":{"url":"https://qnmob3.doubanio.com/lpic/s29623074.jpg?imageView2/0/q/80/w/9999/h/400/format/jpg","width":0,"shape":"rectangle","height":0},"uri":"douban://douban.com/book/27200261","subtype":"","reviewer_name":"","null_rating_reason":""},{"original_price":null,"rating":{"count":101,"max":10,"value":8},"actions":[],"date":null,"year":["2018-1"],"card_subtitle":"[法] 雷蒙·格诺 / 2018 / 人民文学出版社","recommend_comment":"编辑校对能用点儿心么，3*17=21？2小时=120秒？ —— 分分钟炸毛的短评","id":"27603491","title":"风格练习","label":null,"type":"book","description":"","price":null,"press":["人民文学出版社"],"info":"[法] 雷蒙·格诺/人民文学出版社/2018-1","url":"https://www.douban.com/doubanapp/dispatch?uri=/book/27603491/","release_date":null,"author":["[法] 雷蒙·格诺"],"cover":{"url":"https://qnmob3.doubanio.com/lpic/s29637786.jpg?imageView2/0/q/80/w/9999/h/400/format/jpg","width":0,"shape":"rectangle","height":0},"uri":"douban://douban.com/book/27603491","subtype":"","reviewer_name":"","null_rating_reason":""},{"original_price":null,"rating":{"count":256,"max":10,"value":8.3},"actions":["可阅读"],"date":null,"year":["2018-1"],"card_subtitle":"[日] 西加奈子 / 2018 / 湖南文艺出版社","recommend_comment":"人只要还活着，就不能害怕做丢脸的事。我不会偏要让你做个乖孩子。乖孩子，这只不过是大人捏造出来的幻想而已。所有人都做好自己就够了。不过呀，跟乖孩子一样，一本正经地假装成熟也没必要。所以，就算你再努力当好一个成熟的大人，也肯定，肯定有难受和羞耻的时候。这些事是避免不了的。所以啊，要为难受和羞耻的时候做好心理准备。要趁自己还是孩子的时候，做尽丢人的事情，多给人添麻烦，多挨骂，把这些伤害都受一遍，然后才能好好活下去啊 —— 欢脱的喵喵的短评","id":"27176872","title":"鱼河岸小店","label":null,"type":"book","description":"","price":null,"press":["湖南文艺出版社"],"info":"[日] 西加奈子/湖南文艺出版社/2018-1","url":"https://www.douban.com/doubanapp/dispatch?uri=/book/27176872/","release_date":null,"author":["[日] 西加奈子"],"cover":{"url":"https://qnmob3.doubanio.com/lpic/s29652117.jpg?imageView2/0/q/80/w/9999/h/400/format/jpg","width":0,"shape":"rectangle","height":0},"uri":"douban://douban.com/book/27176872","subtype":"","reviewer_name":"","null_rating_reason":""},{"original_price":null,"rating":{"count":8978,"max":10,"value":9.2},"actions":["可阅读"],"date":null,"year":["2018-1"],"card_subtitle":"林奕含 / 2018 / 北京联合出版公司","recommend_comment":"台湾：\n5月12日，台北市政府与台中市政府教育局宣布将要求补习班教师必须使用真名，并上网登记教职员名册。5月16日，台南市政府整合各局处联合启动行动方案，“保儿少防狼师”，此次行动方案包括全面盘点、实名落实、网络合作及服务加值四大主轴，将严格执行补习班稽查与管理。5月26日，立法院通过《补习及进修教育法》修正案，规定补习班应揭露负责人及教职员工真实姓名；外籍教师必须提出良民证；补习班人员若获知有性侵害、性骚扰等情形，有通报责任。\n5月18日，总统府司法改革国是会议决议应当废除通奸罪；若因故无法立即废止，则应即刻删除刑事诉讼法239条但书，即可单独对配偶撤回通奸告诉，仅起诉第三者的条款。\n你国： \n2018年1月8日，清华女生发起反性骚扰运动，消息被立刻封锁、删帖。 —— 林菲的短评","id":"27614904","title":"房思琪的初恋乐园","label":null,"type":"book","description":"","price":null,"press":["北京联合出版公司"],"info":"林奕含/北京联合出版公司/2018-1","url":"https://www.douban.com/doubanapp/dispatch?uri=/book/27614904/","release_date":null,"author":["林奕含"],"cover":{"url":"https://qnmob3.doubanio.com/lpic/s29651121.jpg?imageView2/0/q/80/w/9999/h/400/format/jpg","width":0,"shape":"rectangle","height":0},"uri":"douban://douban.com/book/27614904","subtype":"","reviewer_name":"","null_rating_reason":""},{"original_price":null,"rating":{"count":247,"max":10,"value":8.7},"actions":["可阅读"],"date":null,"year":["2018-1"],"card_subtitle":"[美] 弗拉基米尔·纳博科夫 / 2018 / 上海译文出版社","recommend_comment":"也许更应该去看原著。smh —— aiac的短评","id":"27079433","title":"纳博科夫短篇小说全集","label":null,"type":"book","description":"","price":null,"press":["上海译文出版社"],"info":"[美] 弗拉基米尔·纳博科夫/上海译文出版社/2018-1","url":"https://www.douban.com/doubanapp/dispatch?uri=/book/27079433/","release_date":null,"author":["[美] 弗拉基米尔·纳博科夫"],"cover":{"url":"https://qnmob3.doubanio.com/lpic/s29616411.jpg?imageView2/0/q/80/w/9999/h/400/format/jpg","width":0,"shape":"rectangle","height":0},"uri":"douban://douban.com/book/27079433","subtype":"","reviewer_name":"","null_rating_reason":""},{"original_price":null,"rating":{"count":3868,"max":10,"value":8.7},"actions":[],"date":null,"year":["2018-1"],"card_subtitle":"Priest / 2018 / 百花洲文艺出版社","recommend_comment":"这个小说也能到9分？？麻烦淑芬去看下豆瓣其他9分书的水平吧…… —— 雀仔的短评","id":"27608412","title":"默读","label":null,"type":"book","description":"","price":null,"press":["百花洲文艺出版社"],"info":"Priest/百花洲文艺出版社/2018-1","url":"https://www.douban.com/doubanapp/dispatch?uri=/book/27608412/","release_date":null,"author":["Priest"],"cover":{"url":"https://qnmob3.doubanio.com/lpic/s29663109.jpg?imageView2/0/q/80/w/9999/h/400/format/jpg","width":0,"shape":"rectangle","height":0},"uri":"douban://douban.com/book/27608412","subtype":"","reviewer_name":"","null_rating_reason":""}]
        },
        'book_nonfiction': {
            title: '最受关注图书 | 非虚构类',
            subject_collection_items: [{"original_price":null,"rating":{"count":282,"max":10,"value":8.6},"actions":[],"date":null,"year":["2018-1"],"card_subtitle":"[英] 西蒙·塞巴格·蒙蒂菲奥里 / 2018 / 社会科学文献出版社","recommend_comment":"自吹自擂一发。一部关于people的历史。 —— 陆大鹏Hans的短评","id":"27115938","title":"罗曼诺夫皇朝","label":null,"type":"book","description":"","price":null,"press":["社会科学文献出版社"],"info":"[英] 西蒙·塞巴格·蒙蒂菲奥里/社会科学文献出版社/2018-1","url":"https://www.douban.com/doubanapp/dispatch?uri=/book/27115938/","release_date":null,"author":["[英] 西蒙·塞巴格·蒙蒂菲奥里"],"cover":{"url":"https://qnmob3.doubanio.com/lpic/s29608522.jpg?imageView2/0/q/80/w/9999/h/400/format/jpg","width":0,"shape":"rectangle","height":0},"uri":"douban://douban.com/book/27115938","subtype":"","reviewer_name":"","null_rating_reason":""},{"original_price":null,"rating":{"count":166,"max":10,"value":9.3},"actions":["可阅读"],"date":null,"year":["2018-1-1"],"card_subtitle":"[德] 恩斯特·康托洛维茨 / 2018 / 华东师范大学出版社","recommend_comment":"直接面对的问题是一个抽象的国王如何在中世纪建构起来的，实则追问现代国家作为一个符号的形成。从主要问题牵扯出的线头极多，令人叹为观止的博学，值得三刷！ —— 年方十八发如雪的短评","id":"27086102","title":"国王的两个身体","label":null,"type":"book","description":"","price":null,"press":["华东师范大学出版社"],"info":"[德] 恩斯特·康托洛维茨/华东师范大学出版社/2018-1-1","url":"https://www.douban.com/doubanapp/dispatch?uri=/book/27086102/","release_date":null,"author":["[德] 恩斯特·康托洛维茨"],"cover":{"url":"https://qnmob3.doubanio.com/lpic/s29640403.jpg?imageView2/0/q/80/w/9999/h/400/format/jpg","width":0,"shape":"rectangle","height":0},"uri":"douban://douban.com/book/27086102","subtype":"","reviewer_name":"","null_rating_reason":""},{"original_price":null,"rating":{"count":68,"max":10,"value":8.7},"actions":[],"date":null,"year":["2018-1"],"card_subtitle":"[英] 彼得·沃森 (Peter Watson) / 2018 / 译林出版社","recommend_comment":"其实思想史和文明史一样，如果要写总是会在泛泛和深深之间两难，本书其实已经做得很不错了，毕竟那是跨越人类生命之河的深刻记录。 —— 宝木笑的短评","id":"27136549","title":"思想史","label":null,"type":"book","description":"","price":null,"press":["译林出版社"],"info":"[英] 彼得·沃森 (Peter Watson)/译林出版社/2018-1","url":"https://www.douban.com/doubanapp/dispatch?uri=/book/27136549/","release_date":null,"author":["[英] 彼得·沃森 (Peter Watson)"],"cover":{"url":"https://qnmob3.doubanio.com/lpic/s29580955.jpg?imageView2/0/q/80/w/9999/h/400/format/jpg","width":0,"shape":"rectangle","height":0},"uri":"douban://douban.com/book/27136549","subtype":"","reviewer_name":"","null_rating_reason":""},{"original_price":null,"rating":{"count":183,"max":10,"value":9},"actions":[],"date":null,"year":["2018-1"],"card_subtitle":"[美] 马克·斯特兰德 / 2018 / 浦睿文化·湖南文艺出版社","recommend_comment":"斯特兰德有着清晰的个人声音和自己的语言风貌。在短促的句子里，他坚持冷静地观察生活，同时，坚持让想象力随时浸润生活。让生活变成自我存在的一部分，并随时准备超越生活的滞重。大概，移动，变化，转身，是他最迷恋的姿态和瞬间。在这本集子里，有时可以瞥见他孤冷的自我，有时可以感受到他对他人的渴望。很动人的诗集。 —— 胡桑的短评","id":"27594833","title":"我们生活的故事","label":null,"type":"book","description":"","price":null,"press":["浦睿文化·湖南文艺出版社"],"info":"[美] 马克·斯特兰德/浦睿文化·湖南文艺出版社/2018-1","url":"https://www.douban.com/doubanapp/dispatch?uri=/book/27594833/","release_date":null,"author":["[美] 马克·斯特兰德"],"cover":{"url":"https://qnmob3.doubanio.com/lpic/s29625569.jpg?imageView2/0/q/80/w/9999/h/400/format/jpg","width":0,"shape":"rectangle","height":0},"uri":"douban://douban.com/book/27594833","subtype":"","reviewer_name":"","null_rating_reason":""},{"original_price":null,"rating":{"count":91,"max":10,"value":8.7},"actions":[],"date":null,"year":["2018-1"],"card_subtitle":"[美] 托尼·朱特 / 2018 / 中信出版集团·见识城邦","recommend_comment":"简洁、雄厚、雄辩、冷静、理性，伴随着这本书看的是斯蒂芬平客关于写作的书《写作风格的意识》。让我再一次对这样的公共知识分子表达敬意。 —— Alfred.Gu的短评","id":"27008294","title":"事实改变之后","label":null,"type":"book","description":"","price":null,"press":["中信出版集团·见识城邦"],"info":"[美] 托尼·朱特/中信出版集团·见识城邦/2018-1","url":"https://www.douban.com/doubanapp/dispatch?uri=/book/27008294/","release_date":null,"author":["[美] 托尼·朱特"],"cover":{"url":"https://qnmob3.doubanio.com/lpic/s29630035.jpg?imageView2/0/q/80/w/9999/h/400/format/jpg","width":0,"shape":"rectangle","height":0},"uri":"douban://douban.com/book/27008294","subtype":"","reviewer_name":"","null_rating_reason":""},{"original_price":null,"rating":{"count":2452,"max":10,"value":8.6},"actions":["可阅读"],"date":null,"year":["2018-1"],"card_subtitle":"[美] 瑞·达利欧 / 2018 / 中信出版社","recommend_comment":"纸质书电子化存档，知道这本书和作者是大约一年前笑来老师的纸笔墨，当时这本书的中文版还没有，笑来老师组织人翻译的是一个简版。这次中信出版社把书出的很厚，前面加入了作者的类似自传的经历，把书出的厚厚的，所以能卖98元。\n最近发现吴军老师的硅谷来信的体系-生活和工作原则，和这个作者很像，估计是吴军老师模仿了作者的做法。不要企图一次或者一天读完，这本书适合先翻一遍，然后用Word敲打一遍，然后慢慢读和思考，最后形成自己的生活和工作原则。 —— 码字者的短评","id":"27608239","title":"原则","label":null,"type":"book","description":"","price":null,"press":["中信出版社"],"info":"[美] 瑞·达利欧/中信出版社/2018-1","url":"https://www.douban.com/doubanapp/dispatch?uri=/book/27608239/","release_date":null,"author":["[美] 瑞·达利欧"],"cover":{"url":"https://qnmob3.doubanio.com/lpic/s29643861.jpg?imageView2/0/q/80/w/9999/h/400/format/jpg","width":0,"shape":"rectangle","height":0},"uri":"douban://douban.com/book/27608239","subtype":"","reviewer_name":"","null_rating_reason":""},{"original_price":null,"rating":{"count":561,"max":10,"value":8.3},"actions":[],"date":null,"year":["2018-1"],"card_subtitle":"[英] 马特·海格 / 2018 / 后浪丨江西人民出版社","recommend_comment":"“振作起来。没人知道这有多难。”是啊，可是马特做到了，我也可以。   —— 涵少女的短评","id":"27114418","title":"活下去的理由","label":null,"type":"book","description":"","price":null,"press":["后浪丨江西人民出版社"],"info":"[英] 马特·海格/后浪丨江西人民出版社/2018-1","url":"https://www.douban.com/doubanapp/dispatch?uri=/book/27114418/","release_date":null,"author":["[英] 马特·海格"],"cover":{"url":"https://qnmob3.doubanio.com/lpic/s29636724.jpg?imageView2/0/q/80/w/9999/h/400/format/jpg","width":0,"shape":"rectangle","height":0},"uri":"douban://douban.com/book/27114418","subtype":"","reviewer_name":"","null_rating_reason":""},{"original_price":null,"rating":{"count":685,"max":10,"value":8.9},"actions":[],"date":null,"year":["2018-1-1"],"card_subtitle":"[美] 悉达多·穆克吉 / 2018 / 中信出版集团·见识城邦","recommend_comment":"跟癌症:众病之王一样经典，如果你是用2000积分在WeGene社区换的，那真是挣大了 —— 陈钢的短评","id":"27168433","title":"基因传","label":null,"type":"book","description":"","price":null,"press":["中信出版集团·见识城邦"],"info":"[美] 悉达多·穆克吉/中信出版集团·见识城邦/2018-1-1","url":"https://www.douban.com/doubanapp/dispatch?uri=/book/27168433/","release_date":null,"author":["[美] 悉达多·穆克吉"],"cover":{"url":"https://qnmob3.doubanio.com/lpic/s29632929.jpg?imageView2/0/q/80/w/9999/h/400/format/jpg","width":0,"shape":"rectangle","height":0},"uri":"douban://douban.com/book/27168433","subtype":"","reviewer_name":"","null_rating_reason":""}]
        }
    };

    let loadHotBookList = (selector, title, data) => {
        let template = `
            <header>
                <h2>${title}</h2>
                <a href="/book/hotfiction">更多</a>
            </header>
            <div class="section-content">
                <ul class="row items">
                    ${
                        data['subject_collection_items'].map(item => {
                            return `
                                <li class="item item__book">
                                    <a href="/book/subject/${item['id']}">
                                        <div class="item-poster" style="background-image: url(${item['cover']['url']})"></div>                                
                                        <span class="item-title">${item['title']}</span>
                                        <div class="item-rating">
                                            <span class="rating-stars">
                                            ${
                                                new Array(Math.ceil(item['rating']['value'] / 2))
                                                    .fill('<span class="rating-star rating-star-small-full"></span>')
                                                    .join('\n')
                                            }
                                            ${
                                                new Array(5 - Math.ceil(item['rating']['value'] / 2))
                                                    .fill('<span class="rating-star rating-star-small-gray"></span>')
                                                    .join('\n')
                                            }
                                            </span>
                                            <span>${item['rating']['value']}</span>
                                        </div>
                                    </a>
                                </li>
                            `
                        })
                    }
                </ul>
            </div>
        `;
        document.querySelector(`section#${selector}`).innerHTML = template;
    }

    let requestTypes = {
        'book_fiction': '最受关注图书 | 虚构类',
        'book_nonfiction': '最受关注图书 | 非虚构类'
    };

    Object.keys(requestTypes)
        .forEach(type => {
            fetch(`/api/subject_collection/${type}/items?start=0&count=8`)
            .then(res => res.json())
            .then(res => loadHotBookList(type, requestTypes[type], res));
        });

    /* 加载分类 */
    let types_data = {"小说":"novel","爱情":"love","历史":"history","外国文学":"foreign","青春":"youth","励志":"motivation","随笔":"essay","传记":"bio","推理":"detective","旅行":"travel","奇幻":"fantasy","经管":"business"};
    let types_list_elem = document.querySelector('ul.type-list');
    Object.keys(types_data)
    .forEach(type => {
        let li = document.createElement('LI');
        li.innerHTML = `<a href="/book/${types_data[type]}">${type}<span></span></a>`;
        types_list_elem.appendChild(li);
    })

})(window, document, undefined)